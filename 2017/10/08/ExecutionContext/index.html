<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="执行上下文（Execution Context）"/>




  <meta name="keywords" content="执行上下文,压栈出栈," />




  <link rel="alternate" href="/atom.xml" title="Komorebi">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.4.x" />



<link rel="canonical" href="http://yoursite.com/2017/10/08/ExecutionContext/"/>


<meta name="description" content="执行上下文是 JavaScript 里很重要的一个概念，同时也是很多人一直理不清楚的一个知识点。因为它里面包含的不单单只是一个执行上下文的用法，还涉及到了很多其他大大小小的知识点。 但是因为变量和函数都与执行上下文有密切的关系，弄明白执行上下文，对我们以后学习 JavaScript 都有很大的帮助。所以写了这篇文章，来对执行上下文进行一个大致的分析讲解。">
<meta name="keywords" content="执行上下文,压栈出栈">
<meta property="og:type" content="article">
<meta property="og:title" content="执行上下文（Execution Context）">
<meta property="og:url" content="http://yoursite.com/2017/10/08/ExecutionContext/index.html">
<meta property="og:site_name" content="Komorebi">
<meta property="og:description" content="执行上下文是 JavaScript 里很重要的一个概念，同时也是很多人一直理不清楚的一个知识点。因为它里面包含的不单单只是一个执行上下文的用法，还涉及到了很多其他大大小小的知识点。 但是因为变量和函数都与执行上下文有密切的关系，弄明白执行上下文，对我们以后学习 JavaScript 都有很大的帮助。所以写了这篇文章，来对执行上下文进行一个大致的分析讲解。">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNc79gy1fih36fiku8j31d40ke41y.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNc79gy1fih5cfc4azj31e00mmjuo.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNc79gy1fih68sa2o2j31e00mg0wa.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNc79gy1fih6grz45sj31e00mgtcn.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNc79gy1fih6npspxsj31kw0ikq7b.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNc79gy1fih6tgch25j31kw0gptdg.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNc79gy1fih963p8buj31kw0fuq79.jpg">
<meta property="og:updated_time" content="2017-09-21T12:18:11.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="执行上下文（Execution Context）">
<meta name="twitter:description" content="执行上下文是 JavaScript 里很重要的一个概念，同时也是很多人一直理不清楚的一个知识点。因为它里面包含的不单单只是一个执行上下文的用法，还涉及到了很多其他大大小小的知识点。 但是因为变量和函数都与执行上下文有密切的关系，弄明白执行上下文，对我们以后学习 JavaScript 都有很大的帮助。所以写了这篇文章，来对执行上下文进行一个大致的分析讲解。">
<meta name="twitter:image" content="https://ws2.sinaimg.cn/large/006tNc79gy1fih36fiku8j31d40ke41y.jpg">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.4.x" />







<script>
  var CONFIG = {
    search: true,
    searchPath: "/search.xml",
    fancybox: false,
    toc: true,
  }
</script>




  



    <title> 执行上下文（Execution Context） · Komorebi </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Komorebi</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            Categories
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Komorebi</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
      
        <li class="menu-search">
          <form>
            <i class="iconfont icon-search" id="open-search"></i>
            <input type="text" class="search-input" id="search-input" />
            <i class="iconfont icon-close" id="close-search"></i>
          </form>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          执行上下文（Execution Context）
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017年10月8日
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#概述"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#上下文的分类"><span class="toc-text">上下文的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#全局上下文"><span class="toc-text">全局上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局部上下文"><span class="toc-text">局部上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#eval上下文"><span class="toc-text">eval上下文</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行上下文栈"><span class="toc-text">执行上下文栈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码例子分析"><span class="toc-text">代码例子分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#练习"><span class="toc-text">练习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p>执行上下文是 JavaScript 里很重要的一个概念，同时也是很多人一直理不清楚的一个知识点。因为它里面包含的不单单只是一个执行上下文的用法，还涉及到了很多其他大大小小的知识点。</p>
<p>但是因为变量和函数都与执行上下文有密切的关系，弄明白执行上下文，对我们以后学习 JavaScript 都有很大的帮助。所以写了这篇文章，来对执行上下文进行一个大致的分析讲解。</p>
<a id="more"></a>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在理解执行上下文的内部原理之前，我们先来弄明白“执行上下文”的字面意思。</p>
<p>“上下文”这个词不是我们第一次听说。在学生时代做语文阅读题的时候，我们常常会看到这种题目：</p>
<blockquote>
<p>结合上下文，分析这句话作者想要表达什么意思？</p>
</blockquote>
<p>假设上面题目中需要我们分析的那句话是：“我谢谢你”。</p>
<p>单看这四个字，我们能分析出这四个字要表达的意思吗？正常人应该都不能。所以这个时候要怎么办？一般情况下我们会去看文章中在这句话前后的一些其他描述，分析出当时说这句话时的情景。</p>
<p>也就时说，题目中的“结合上下文“，其实就是让我们结合当时的情景。</p>
<p>文章中一句话具体什么含义，取决于当时说这句话时的情景，其实也就是这句话的上下文。</p>
<p>同样的，在 JavaScript 中，我们的一行代码，运行之后是什么结果，也取决于它当时所处的环境，也就是这行代码的上下文。</p>
<p>所以，说了这么多，执行上下文到底是什么？</p>
<blockquote>
<p>站在代码之外的角度：执行上下文，就是说这句话或做的这件事时的所处情景。</p>
<p>站在代码的角度：执行上下文，就是当前代码的执行环境。</p>
</blockquote>
<h2 id="上下文的分类"><a href="#上下文的分类" class="headerlink" title="上下文的分类"></a>上下文的分类</h2><p>在 JavaScript 中有三种代码运行的环境。也就是说执行上下文，分为了三类：</p>
<ul>
<li>全局上下文</li>
<li>局部上下文</li>
<li>eval上下文</li>
</ul>
<h3 id="全局上下文"><a href="#全局上下文" class="headerlink" title="全局上下文"></a>全局上下文</h3><p>当我们打开浏览器的时候就已经存在了一个全局的执行环境，这个全局的执行环境就是我们所说的“全局上下文”。全局上下文属于浏览器，只要没有关闭浏览器，全局上下文就会一直存在。</p>
<h3 id="局部上下文"><a href="#局部上下文" class="headerlink" title="局部上下文"></a>局部上下文</h3><p>当一个函数被调用时，会产生一个函数体内的执行环境，这个函数体内的执行环境就是我们所说的“局部上下文”。局部上下文属于函数，所以当函数执行完成后，当前局部上下文就会销毁掉。</p>
<h3 id="eval上下文"><a href="#eval上下文" class="headerlink" title="eval上下文"></a>eval上下文</h3><p>用的少，也不推荐使用，所以不讲。ㄟ( ▔, ▔ )ㄏ</p>
<h2 id="执行上下文栈"><a href="#执行上下文栈" class="headerlink" title="执行上下文栈"></a>执行上下文栈</h2><p>我们在前面提到：当浏览器打开时，就存在一个全局上下文，每次调用一个函数，又会产生局部上下文。当函数调用完成时，它的上下文以及其中的数据都会被消除，最终再重新回到全局上下文中。</p>
<p>处于活动状态的执行上下文只有一个。</p>
<p>其实这就是一个<strong>压栈出栈</strong>的过程 —— 执行上下文栈。如下图：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fih36fiku8j31d40ke41y.jpg" alt=""></p>
<p>全局上下文在浏览器关闭之后出栈。</p>
<p>附：“栈空间”就是指的内存空间里的一块区域。需要详细了解栈空间的可以先去看前面的<a href="https://runjaelyn.github.io/2017/09/08/memory/" target="_blank" rel="external">《JavaScript 内存空间》</a>这篇文章。</p>
<h3 id="代码例子分析"><a href="#代码例子分析" class="headerlink" title="代码例子分析"></a>代码例子分析</h3><p>我们通过一段来具体看一下执行上下文的压栈出栈过程。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log( <span class="string">"inner"</span> );</div><div class="line">	&#125;</div><div class="line">	inner();</div><div class="line">&#125;</div><div class="line">outer();</div></pre></td></tr></table></figure>
<p>这里还是通过图解来进行分析。首先第一步：全局上下文入栈。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fih5cfc4azj31e00mmjuo.jpg" alt=""></p>
<p>全局上下文入栈后，其中的可执行代码开始执行。直到执行到第 7 行代码<code>outer()</code>，函数<code>outer</code>被调用，激活函数<code>outer</code>创建它自己的执行上下文。</p>
<p>因此，第二步：函数<code>outer</code>的执行上下文入栈。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fih68sa2o2j31e00mg0wa.jpg" alt=""></p>
<p><code>outer</code>的上下文入栈了之后，JavaScript 解释器开始执行<code>outer</code>函数内部的可执行代码。遇到<code>inner()</code>后又开始调用<code>inner</code>函数，激活函数<code>inner</code>创建它自己的执行上下文。</p>
<p>因此，第三步：函数<code>inner</code>的执行上下文入栈。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fih6grz45sj31e00mgtcn.jpg" alt=""></p>
<p><code>inner</code>的上下文入栈了之后，JavaScript 解释器开始执行<code>inner</code>函数内部的可执行代码，然后没有再遇到其他能生成执行上下文的情况，因此函数<code>inner</code>内的代码顺利执行完毕，<code>inner</code>的上下文销毁。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fih6npspxsj31kw0ikq7b.jpg" alt=""></p>
<p><code>inner</code>的上下文销毁之后，继续执行函数<code>outer</code>内的可执行代码，也没有再遇到其他能生成执行上下文的情况，因此函数<code>outer</code>内的代码也顺利执行完毕，<code>outer</code>上下文销毁。这样，栈空间中就只剩下全局上下文了。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fih6tgch25j31kw0gptdg.jpg" alt=""></p>
<p>当浏览器窗口关闭后全局上下文出栈。</p>
<blockquote>
<p>注意：在函数中，如果遇到<code>return</code>会直接终止函数内可执行代码的执行，因此函数调用也会立即完成，所以函数的上下文也会立即从栈空间中销毁。</p>
</blockquote>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>为了巩固对执行上下文的理解，我们最后再来分析一个代码例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> n = <span class="number">123</span>;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log( n );</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> bar;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> result = foo();</div><div class="line">result(); <span class="comment">// 123</span></div></pre></td></tr></table></figure>
<p>函数<code>bar</code>在函数<code>foo</code>中，并没有被调用执行。因此，执行<code>foo</code>的时，<code>bar</code>不会创建新的上下文，而是直到<code>result</code>执行时，才创建了一个新的。具体过程如下：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fih963p8buj31kw0fuq79.jpg" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>了解完整个过程之后，我们就可以对执行上下文总结一些结论了。</p>
<ul>
<li>单线程</li>
<li>同步执行，只要栈顶的上下文处于执行中，其他上下文需要等待</li>
<li>全局上下文只有唯一的一个，在浏览器打开时创建入栈，在浏览器关闭时销毁出栈</li>
<li>局部上下文个数没有限制，在每次函数被调用时创建入栈，函数执行完成后销毁出栈</li>
<li>同一个函数被调用多少次，就会产生多少执行上下文，即使是自己调用自己</li>
</ul>

      
    </div>

    
      
      



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="https://ws2.sinaimg.cn/large/006tKfTcgy1fi12xd8ywlj30j20j1mz1.jpg" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="https://ws3.sinaimg.cn/large/006tKfTcgy1fi130oybncj30ad0addgn.jpg" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/执行上下文/">执行上下文</a>
            
              <a href="/tags/压栈出栈/">压栈出栈</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2017/10/06/hoisting/">
        <span class="next-text nav-default">变量提升和函数提升</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>

  <div id="gitmentContainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
      owner: 'runJaelyn',
      repo: 'runJaelyn.github.io',
      oauth: {
          client_id: '82eade5c20915f7d2145',
          client_secret: '5edb8f42b6dfe9846b1e7eca5df3d6323683f116',
      },
  });
  gitment.render('gitmentContainer');
  </script>
  


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Jaelyn</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  



    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.4.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.4.x"></script>

    
  <script type="text/html" id="search-result">
    <article class="post">
      <header class="post-header">
        <h1 class="post-title">
          <a href="$url$" class="post-link">
            $title$
          </a>
        </h1>
      </header>
      <div class="post-content">
        $content$
        <div class="read-more">
          <a href="$url$" class="read-more-link">
            阅读更多
          </a>
        </div>
      </div>
    </article>
  </script>
  <script type="text/html" id="no-search-result">
    <div class="no-result">
      <h2>No result found!</h2>
    </div>
  </script>
  <script type="text/javascript" src="/js/src/search.js?v=2.4.x"></script>

  </body>
</html>
